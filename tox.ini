[tox]
envlist =
    ruff
    mypy
    py311-unit
    py311-agent-memory-sanity
    py311-anthropic
    py311-openai
    py311-legacy
    py311-chromadb
    py311-qdrant
    py311-faiss
    py311-postgres-sanity
    py311-sqlite-sanity
    py311-snowflake-sanity
    py311-mysql-sanity
    py311-clickhouse-sanity
    py311-oracle-sanity
    py311-bigquery-sanity
    py311-duckdb-sanity
    py311-mssql-sanity
    py311-presto-sanity
    py311-hive-sanity

[testenv]
deps =
    pytest>=7.0.0
    pytest-asyncio>=0.21.0

[testenv:py311-unit]
description = Run unit tests (no external dependencies required)
commands =
    pytest tests/test_tool_permissions.py tests/test_llm_context_enhancer.py tests/test_workflow.py tests/test_memory_tools.py -v

[testenv:py311-agent-memory-sanity]
description = Run sanity tests for all AgentMemory implementations (no actual service connections required)
deps =
    pytest>=7.0.0
    pytest-asyncio>=0.21.0
extras =
    chromadb
    qdrant
commands =
    pytest tests/test_agent_memory_sanity.py -v

[testenv:py311-anthropic]
description = Test with Anthropic
extras = anthropic
passenv = ANTHROPIC_API_KEY
commands =
    python -c "from vanna.integrations.anthropic import AnthropicLlmService; print('✓ Anthropic import successful')"
    pytest tests/ -v -m anthropic

[testenv:py311-openai]
description = Test with OpenAI
extras = openai
passenv = OPENAI_API_KEY
commands =
    python -c "from vanna.integrations.openai import OpenAILlmService; print('✓ OpenAI import successful')"
    pytest tests/ -v -m openai

; [testenv:py311-gemini]
; description = Test with Google Gemini
; extras = gemini
; passenv =
;     GOOGLE_API_KEY
;     GEMINI_API_KEY
; commands =
;     python -c "from vanna.integrations.google import GeminiLlmService; print('✓ Gemini import successful')"
;     pytest tests/ -v -m gemini

; [testenv:py311-ollama]
; description = Test with Ollama
; extras = ollama
; passenv = OLLAMA_HOST
; commands =
;     python -c "from vanna.integrations.ollama import OllamaLlmService; print('✓ Ollama import successful')"
;     pytest tests/ -v -m ollama

[testenv:py311-legacy]
description = Test LegacyVannaAdapter with Anthropic
extras =
    anthropic
    chromadb
passenv = ANTHROPIC_API_KEY
commands =
    python -c "from vanna.legacy.adapter import LegacyVannaAdapter; from vanna.legacy.chromadb import ChromaDB_VectorStore; from vanna.legacy.mock import MockLLM; print('✓ Legacy adapter imports successful')"
    pytest tests/test_legacy_adapter.py -v -m legacy

[testenv:py311-chromadb]
description = Test ChromaDB AgentMemory
extras = chromadb
commands =
    pytest tests/test_agent_memory.py::TestLocalAgentMemory -k chromadb -v

[testenv:py311-qdrant]
description = Test Qdrant AgentMemory
extras = qdrant
commands =
    pytest tests/test_agent_memory.py::TestLocalAgentMemory -k qdrant -v

[testenv:py311-faiss]
description = Test FAISS AgentMemory
deps =
    pytest>=7.0.0
    pytest-asyncio>=0.21.0
    faiss-cpu
commands =
    pytest tests/test_agent_memory.py::TestLocalAgentMemory -k faiss -v

[testenv:py311-db-sanity]
description = Run sanity tests for all database implementations (no actual DB connections required)
deps =
    pytest>=7.0.0
    pytest-asyncio>=0.21.0
    pytest-mock>=3.10.0
extras =
    postgres
commands =
    pytest tests/test_database_sanity.py -v

[testenv:py311-postgres-sanity]
description = Sanity tests for PostgreSQL implementation
deps =
    pytest>=7.0.0
    pytest-asyncio>=0.21.0
extras = postgres
commands =
    python -c "from vanna.integrations.postgres import PostgresRunner; print('✓ PostgresRunner import successful')"
    pytest tests/test_database_sanity.py::TestPostgresRunner -v

[testenv:py311-sqlite-sanity]
description = Sanity tests for SQLite implementation
deps =
    pytest>=7.0.0
    pytest-asyncio>=0.21.0
commands =
    python -c "from vanna.integrations.sqlite import SqliteRunner; print('✓ SqliteRunner import successful')"
    pytest tests/test_database_sanity.py::TestSqliteRunner -v

[testenv:py311-snowflake-sanity]
description = Sanity tests for Snowflake implementation
deps =
    pytest>=7.0.0
    pytest-asyncio>=0.21.0
extras = snowflake
commands =
    python -c "from vanna.integrations.snowflake import SnowflakeRunner; print('✓ SnowflakeRunner import successful')"
    pytest tests/test_database_sanity.py::TestSnowflakeRunner -v

[testenv:py311-mysql-sanity]
description = Sanity tests for MySQL implementation
deps =
    pytest>=7.0.0
    pytest-asyncio>=0.21.0
extras = mysql
commands =
    python -c "from vanna.integrations.mysql import MySQLRunner; print('✓ MySQLRunner import successful')"
    pytest tests/test_database_sanity.py::TestMySQLRunner -v

[testenv:py311-clickhouse-sanity]
description = Sanity tests for ClickHouse implementation
deps =
    pytest>=7.0.0
    pytest-asyncio>=0.21.0
extras = clickhouse
commands =
    python -c "from vanna.integrations.clickhouse import ClickHouseRunner; print('✓ ClickHouseRunner import successful')"
    pytest tests/test_database_sanity.py::TestClickHouseRunner -v

[testenv:py311-oracle-sanity]
description = Sanity tests for Oracle implementation
deps =
    pytest>=7.0.0
    pytest-asyncio>=0.21.0
extras = oracle
commands =
    python -c "from vanna.integrations.oracle import OracleRunner; print('✓ OracleRunner import successful')"
    pytest tests/test_database_sanity.py::TestOracleRunner -v

[testenv:py311-bigquery-sanity]
description = Sanity tests for BigQuery implementation
deps =
    pytest>=7.0.0
    pytest-asyncio>=0.21.0
extras = bigquery
commands =
    python -c "from vanna.integrations.bigquery import BigQueryRunner; print('✓ BigQueryRunner import successful')"
    pytest tests/test_database_sanity.py::TestBigQueryRunner -v

[testenv:py311-duckdb-sanity]
description = Sanity tests for DuckDB implementation
deps =
    pytest>=7.0.0
    pytest-asyncio>=0.21.0
extras = duckdb
commands =
    python -c "from vanna.integrations.duckdb import DuckDBRunner; print('✓ DuckDBRunner import successful')"
    pytest tests/test_database_sanity.py::TestDuckDBRunner -v

[testenv:py311-mssql-sanity]
description = Sanity tests for MSSQL implementation
deps =
    pytest>=7.0.0
    pytest-asyncio>=0.21.0
extras = mssql
commands =
    python -c "from vanna.integrations.mssql import MSSQLRunner; print('✓ MSSQLRunner import successful')"
    pytest tests/test_database_sanity.py::TestMSSQLRunner -v

[testenv:py311-presto-sanity]
description = Sanity tests for Presto implementation
deps =
    pytest>=7.0.0
    pytest-asyncio>=0.21.0
extras = presto
commands =
    python -c "from vanna.integrations.presto import PrestoRunner; print('✓ PrestoRunner import successful')"
    pytest tests/test_database_sanity.py::TestPrestoRunner -v

[testenv:py311-hive-sanity]
description = Sanity tests for Hive implementation
deps =
    pytest>=7.0.0
    pytest-asyncio>=0.21.0
extras = hive
commands =
    python -c "from vanna.integrations.hive import HiveRunner; print('✓ HiveRunner import successful')"
    pytest tests/test_database_sanity.py::TestHiveRunner -v

[testenv:ruff]
description = Check code formatting and linting with ruff (uses pyproject.toml config)
extras = dev
commands =
    ruff format --check src/vanna/ tests/
    ruff check src/vanna/ tests/

[testenv:mypy]
description = Run mypy type checking with strict mode
extras = dev
commands =
    mypy src/vanna/tools src/vanna/core src/vanna/capabilities src/vanna/agents src/vanna/utils src/vanna/web_components src/vanna/components --strict
